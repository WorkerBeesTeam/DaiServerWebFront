<div class="chart_conf">
  <div class="chart_type">
    <div class="time-filter">
        <mat-form-field class="chart-time">
          <input type="time" matInput i18n-placeholder="@@REPORTS.TIME_FROM" placeholder="Время от" [(ngModel)]="time_from" required>
        </mat-form-field>
        <mat-form-field class="chart-date">
          <input matInput [matDatepicker]="picker_from" [formControl]="date_from" i18n-placeholder="@@REPORTS.DATE_FROM" placeholder="Дата от" required>
          <mat-datepicker-toggle matSuffix [for]="picker_from"></mat-datepicker-toggle>
          <mat-datepicker #picker_from></mat-datepicker>
        </mat-form-field>
    </div>

    <div class="time-filter">
        <mat-form-field class="chart-time">
          <input type="time" matInput i18n-placeholder="@@REPORTS.TIME_TO" placeholder="Время до" [(ngModel)]="time_to" required>
        </mat-form-field>
        <mat-form-field class="chart-date">
          <input matInput [matDatepicker]="picker_to" [formControl]="date_to" i18n-placeholder="@@REPORTS.DATE_TO" placeholder="Дата до" required>
          <mat-datepicker-toggle matSuffix [for]="picker_to"></mat-datepicker-toggle>
          <mat-datepicker #picker_to></mat-datepicker>
        </mat-form-field>
    </div>
  </div>

  <fieldset class="chart_type">
    <legend i18n="@@REPORTS.CHARTS.DECOMPOSE">Разложить</legend>
    <mat-radio-group class="charts-type-group" [(ngModel)]="charts_type" (change)="OnChartsType()">
      <mat-radio-button class="charts-type-button" [value]="chartType.CT_USER" i18n="@@REPORTS.CHARTS.USERCHOICE" [disabled]="!user_charts || !user_charts.length">Пользовательский</mat-radio-button>
      <mat-radio-button class="charts-type-button" [value]="chartType.CT_DIG_TYPE" i18n="@@REPORTS.CHARTS.DECOMPOSE_BY_GROUPS">По группам элементов</mat-radio-button>
      <mat-radio-button class="charts-type-button" [value]="chartType.CT_DEVICE_ITEM_TYPE" i18n="@@REPORTS.CHARTS.DECOMPOSE_BY_TYPES">По типам элементов</mat-radio-button>
      <mat-radio-button class="charts-type-button" [value]="chartType.CT_DEVICE_ITEM" i18n="@@REPORTS.CHARTS.DECOMPOSE_BY_ITEMS">По элементам</mat-radio-button>
    </mat-radio-group>
  </fieldset>

  <angular2-multiselect [data]="itemList"
                        [(ngModel)]="selectedItems"
                        [settings]="settings"
                        (onSelect)="onItemSelect($event)"
                        (ngModelChange)="rebuild()"
  >
  </angular2-multiselect>

  <angular2-multiselect *ngIf="paramList" [data]="paramList"
                        [(ngModel)]="paramSelected"
                        [settings]="paramSettings"
                        (ngModelChange)="rebuild()"
  >
  </angular2-multiselect>
  <div *ngIf="charts_type == chartType.CT_USER"
       class="save-block">
    <button mat-raised-button (click)="edit_user_chart()" i18n="@@CONTROL.EDIT">Изменить</button>
    <button mat-raised-button (click)="del_user_chart()" i18n="@@CONTROL.DEL">Удалить</button>
  </div>

  <div *ngIf="charts_type == chartType.CT_DEVICE_ITEM"
       class="save-block">
    <mat-form-field>
      <input matInput i18n-placeholder="@@REPORTS.NAME" placeholder="Имя графика" [(ngModel)]="user_chart.name" required>
    </mat-form-field>

    <button *ngIf="user_chart.id" mat-raised-button (click)="save_user_chart()" i18n="@@CONTROL.EDIT">Изменить</button>
    <button *ngIf="!user_chart.id" mat-raised-button (click)="save_user_chart()" i18n="@@CONTROL.SAVE">Сохранить</button>
  </div>

    <div class="legend-container" *ngFor="let chart of selected_charts">
        <p>{{ chart.name }}</p>
        <a>Random color <!-- TODO:  (click)="random_color()" --></a>
        <div class="legend">
            <div class="legend__item" *ngFor="let ds of chart.dataset_params">
                <div class="legend__item-color" [style.background-color]="ds.legend.displayColor" (click)="openColorPicker(chart, ds)"></div>
                <div class="legend__item-label" [style.text-decoration]="ds.legend.hidden ? 'line-through' : 'inherit'" (click)="toggleDatasetVisibility(ds)">{{ ds.item.param?.title || ds.item.type?.title }}</div>
            </div>
        </div>
    </div>

    <button mat-raised-button (click)="buildChart()" i18n="@@CONTROL.SHOW">Построить график</button>
</div>
