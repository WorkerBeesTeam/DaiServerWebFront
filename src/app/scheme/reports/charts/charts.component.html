<h2 i18n="@@REPORTS.CHARTS.TITLE">Графики</h2>

<ng-container *ngIf="initialized">
<div class="chart_conf">
  <mat-form-field>
    <input type="time" matInput i18n-placeholder="@@REPORTS.TIME_FROM" placeholder="Время от" [(ngModel)]="time_from" required>
  </mat-form-field>
  <mat-form-field>
    <input matInput [matDatepicker]="picker_from" [formControl]="date_from" i18n-placeholder="@@REPORTS.DATE_FROM" placeholder="Дата от" required>
    <mat-datepicker-toggle matSuffix [for]="picker_from"></mat-datepicker-toggle>
    <mat-datepicker #picker_from></mat-datepicker>
  </mat-form-field>

  <mat-form-field>
    <input type="time" matInput i18n-placeholder="@@REPORTS.TIME_TO" placeholder="Время до" [(ngModel)]="time_to" required>
  </mat-form-field>
  <mat-form-field>
    <input matInput [matDatepicker]="picker_to" [formControl]="date_to" i18n-placeholder="@@REPORTS.DATE_TO" placeholder="Дата до" required>
    <mat-datepicker-toggle matSuffix [for]="picker_to"></mat-datepicker-toggle>
    <mat-datepicker #picker_to></mat-datepicker>
  </mat-form-field>

  <br>
  <div class="chart_type">
    <span i18n="@@REPORTS.CHARTS.DECOMPOSE">Разложить</span>:
    <mat-radio-group class="charts-type-group" [(ngModel)]="charts_type">
      <mat-radio-button class="charts-type-button" [value]="chartType.CT_DIG_TYPE" checked i18n="@@REPORTS.CHARTS.DECOMPOSE_BY_GROUPS">По группам элементов</mat-radio-button>
      <mat-radio-button class="charts-type-button" [value]="chartType.CT_DEVICE_ITEM_TYPE" i18n="@@REPORTS.CHARTS.DECOMPOSE_BY_TYPES">По типам элементов</mat-radio-button>
      <mat-radio-button class="charts-type-button" [value]="chartType.CT_DEVICE_ITEM" i18n="@@REPORTS.CHARTS.DECOMPOSE_BY_ITEMS">По элементам</mat-radio-button>
    </mat-radio-group>
  </div>

  <div class="chart_type" [ngSwitch]="charts_type">
    <ng-container *ngSwitchCase="chartType.CT_DIG_TYPE">
      <a *ngFor="let item of group_types"
        [class.active]="selected_group_type && selected_group_type.id == item.id"
        (click)="selectGroup(item)">{{item.title}}</a>
    </ng-container>

    <ng-container *ngSwitchCase="chartType.CT_DEVICE_ITEM_TYPE">
      <mat-form-field>
        <mat-label i18n="@@REPORTS.CHARTS.SELECT_TYPE">Выберите тип элемента</mat-label>
        <mat-select [formControl]="itemtypes" multiple>
          <mat-option *ngFor="let t of itemTypeList" [value]="t.id">{{t.title}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ng-container>

    <ng-container *ngSwitchCase="chartType.CT_DEVICE_ITEM">
      <mat-form-field>
        <mat-label i18n="@@REPORTS.CHARTS.SELECT_ITEM">Выберите элемент</mat-label>
        <mat-select [formControl]="devitems" multiple>
          <mat-option *ngFor="let it of devItemList" [value]="it.id">{{it.name}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ng-container>
  </div>

  <button mat-raised-button (click)="initCharts()" i18n="@@CONTROL.SHOW">Построить график</button>
</div>

  <div *ngFor="let chart of charts">
    <h2>{{chart.name}}</h2>
    <chart #chart_obj [type]="type" [data]="chart.data" [options]="options"></chart>

    <div class="legend">
      <div class="legend__item" *ngFor="let dataset of chart.data.datasets">
        <div class="legend__item-color" [style.background-color]="dataset.pointBorderColor"></div><div class="legend__item-label">{{ dataset.label }}</div>
      </div>
      <a (click)="random_color()">Random color</a>
    </div>
  </div>
</ng-container>
<ng-container *ngIf="!initialized">
  <mat-progress-spinner [mode]="prgMode" [value]="prgValue"></mat-progress-spinner>
  <button mat-raised-button (click)="breakLoad()" i18n="@@CHARTS.BREAK_LOAD">Прервать загрузку</button>
</ng-container>
